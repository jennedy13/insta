<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>API</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="reset.css" />
    <link rel="stylesheet" href="styles.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js" defer></script>
    <script type="module" defer>
        import { createClient } from "https://esm.sh/@supabase/supabase-js"

        const SUPABASE_URL = 'https://kyrkshvrtfdyksnduxon.supabase.co'
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt5cmtzaHZydGZkeWtzbmR1eG9uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1MjY2MTQsImV4cCI6MjA3MzEwMjYxNH0.51wxv0R3pM089tm16__OE_u9MxewSNRmOR-zWd7Tslc'

        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

        $(document).ready(function () {

            async function addLocation(ip, country, city, latitude, longitude) {
                const { data, error } = await supabase
                    .from('logs')
                    .insert([{ ip, country, city, latitude, longitude }]);

                if (error) {
                    console.error('Error occurred:', error)
                } else {
                    console.log('Data added successfully:', data)
                }
            }

            async function fetchData() {
                let url = `https://ipapi.co/json`;
                let response = await fetch(url);
                let data = await response.json();
                return data;
            }

            fetchData().then(data => {
                addLocation(`${data.ip} on site load`, data.country_name, data.city, data.latitude, data.longitude);
            });

            $('#saveBtn').on("click", async function (e) {
                e.preventDefault();
                let data = await fetchData();

                $('#ip').text(`Your IP: ${data.ip}`);
                $('#country').text(`Your country: ${data.country_name}`);
                $('#city').text(`Your city: ${data.city}`);
                $('#org').text(`Your internet provider: ${data.org}`);

                await addLocation(data.ip, data.country_name, data.city, data.latitude, data.longitude);
            });
        });
    </script>


    <!-- <script type="module" defer>
        import { createClient } from "https://esm.sh/@supabase/supabase-js"

        const SUPABASE_URL = 'https://kyrkshvrtfdyksnduxon.supabase.co'
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt5cmtzaHZydGZkeWtzbmR1eG9uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1MjY2MTQsImV4cCI6MjA3MzEwMjYxNH0.51wxv0R3pM089tm16__OE_u9MxewSNRmOR-zWd7Tslc'

        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
        $(document).ready(function () {
            //e.preventDefault();
            let url = `https://ipapi.co/json`;

            async function getinfo() {
                let response = await fetch(url);
                let data = await response.json();

                $('#ip').append(data.ip);
                $('#country').append(data.country_name);
                $('#city').append(data.city);
                $('#org').append(data.org);
                console.log(data);

                await addLocation(
                    data.ip + " on site load",
                    data.country_name,
                    data.city,
                    data.latitude,
                    data.longitude
                );
                $('#saveBtn').one("click", function (e) {
                    e.preventDefault();
                    let url = `https://ipapi.co/json`;

                    async function getinfo() {
                        let response = await fetch(url);
                        let data = await response.json();

                        $('#ip').append(data.ip);
                        $('#country').append(data.country_name);
                        $('#city').append(data.city);
                        $('#org').append(data.org);
                        console.log(data);

                        await addLocation(
                            data.ip,
                            data.country_name,
                            data.city,
                            data.latitude,
                            data.longitude
                        );
                    }

                    getinfo();
                });

                async function addLocation(ip, country, city, latitude, longitude) {
                    const { data, error } = await supabase
                        .from('logs')
                        .insert([{ ip, country, city, latitude, longitude }]);

                    if (error) {
                        console.error('Error occurred:', error)
                    } else {
                        console.log('Data added successfully:', data)
                    }
                }
            };
    </script> -->
</head>

<body>
    <section id="first">
        <div class="container">
            <div class="row">
                <div class="col-md-12 d-flex flex-column align-items-center justify-content-center">
                    <div class="box">
                        <h1 id="ip">Your IP: </h1>
                        <hr style="border: 1px solid black; margin: 10px 0;">
                        <h1 id="country">Your country: </h1>
                        <hr style="border: 1px solid black; margin: 10px 0;">
                        <h1 id="city">Your city: </h1>
                        <hr style="border: 1px solid black; margin: 10px 0;">
                        <h1 id="org">Your internet provider: </h1>
                    </div>
                    <button>
                        <span class="button_top" id="saveBtn"> USE </span>
                    </button>
                </div>
            </div>
        </div>
    </section>

</body>


</html>